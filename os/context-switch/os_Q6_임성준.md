### 프로세스와 스레드는 컨텍스트 스위칭이 발생했을 때 어떤 차이가 있을까요?

- CPU에서 실행 중이던 프로세스/스레드가 다른 프로세스/스레드로 교체되는 것
- 여러 프로세스/스레드를 동시에 실행시키기 위해서 필요하다.

**프로세스 CS와 스레드 CS의 공통점과 차이점**

공통점 

- 커널 모드에서 실행
- CPU의 레지스터 상태를 교체

차이점 

- 프로세스의 컨텍스트 스위칭
    - 서로 다른 프로세스에 속한 스레드 간의 컨텍스트 스위칭 발생
    - 가상 메모리 주소 관련 처리를 추가로 수행 → MMU, TLB 다시 세팅한다.
- 스레드 컨텍스트 스위칭
    - 같은 프로세스에 속한 스레드 간의 컨텍스트 스위칭 발생
    - 더 빠르다 → 메모리 주소 관련 처리를 하지 않기 때문이다.

- 현재 실행 중인 프로세스 혹은 스레드의 context 백업(CPU 레지스터 값들, 어디까지 실행됐는지)
   **→ 스레드 컨텍스트 스위칭은 이것만 수행한다.**

- CPU 캐시를 비움

- TLB(table lookaside buffer)을 비움

- MMU(memory management unit) 설정을 변경 
  : 가상 메모리 주소에서 물리적인 메모리 주소로 변환하는 역할

https://hello-judy-world.tistory.com/191

### 컨텍스트 스위칭이 발생할 때, 기존의 프로세스 정보는 커널 스택에 어떠한 형식으로 저장되나요?

<img src="https://github.com/sungjun0629/blog-study/assets/113486696/c8b2719b-556b-4224-9d7f-08905ec627d3">

커널 스택은 각 프로세스나 스레드가 커널 모드에서 실행될 때 사용되는 스택이며, 이 스택에는 중요한 상태 정보가 저장됩니다.

1. **현재 실행 중인 프로세스 정보 저장:**
    - 현재 레지스터 상태, 프로그램 카운터(PC) 값, 스택 포인터(SP) 등이 커널 스택에 저장됩니다.
2. **다음 실행할 프로세스 정보 복원:**
    - 다음 실행할 프로세스의 레지스터 상태, 프로그램 카운터 값, 스택 포인터 등이 커널 스택에서 복원됩니다.

PCB는 프로세스에 대한 모든 정보를 저장하는 자료구조이며, 이는 프로세스의 상태를 추적하고 관리하는 데 사용됩니다. 커널 스택은 현재 실행 중인 프로세스나 스레드의 실행에 필요한 지역적인 데이터를 보관하는 데 사용됩니다.

### 컨텍스트 스위칭은 언제 일어날까요?

1. **프로세스 스케줄링:**
    - 운영체제의 스케줄러가 다른 프로세스에 CPU를 할당할 때 발생합니다. 스케줄러는 현재 실행 중인 프로세스를 중단하고, 대기 중인 다른 프로세스로 CPU를 전환하기 위해 컨텍스트 스위칭을 수행합니다.
2. **인터럽트:**
    - 하드웨어 인터럽트나 소프트웨어 인터럽트(예: 시스템 호출)가 발생하면, 현재 실행 중인 작업을 중단하고 인터럽트 서비스 루틴으로 제어를 전달하기 위해 컨텍스트 스위칭이 필요합니다.
3. **시스템 호출:**
    - 프로세스가 운영체제에 특정 서비스를 요청할 때, 시스템 호출이 발생하며 이때도 컨텍스트 스위칭이 필요할 수 있습니다.
4. **프로세스 간 통신:**
    - 다른 프로세스와의 통신을 위해 대기 상태에 있는 프로세스가 깨어나서 실행될 때도 컨텍스트 스위칭이 발생할 수 있습니다.

컨텍스트 스위칭은 상대적으로 비용이 큰 작업이므로, 효율적인 스케줄링과 최적화 기술이 중요합니다. 이를 통해 CPU 자원을 효율적으로 활용하고 응답 시간을 최소화할 수 있습니다.

